# AT&T Assembly, Assembling and Linking with the I/O Routines

Assembly programs are structured into sections. For our purposes, we require two sections: the `.text` section contains assembled machine code, while the `.data` section holds global variables.

Here is a skeleton file for programs in AT&T syntax:
```asm
# template
    .text                   # beginning of the text section
    .align 8                # align text section at an 8-byte boundary

    .global main            # to let the assembler know that we implement
                            # the function "main" (= module body)

    .extern ReadInt         # externally defined functions
    ...                     # (I/O, array handling)


main:                       # module body, followed by functions/procedures
    ...


    .data                   # beginning of the data section
    .align 8                # align at an 8-byte boundary

p:  .long 1                 # global array 'p': integer[10]
    .long 4
    .skip 40
x:  .skip 1                 # global variable 'x' (1 byte)

    .end                    # end of program
```

Be aware that labels must be local or unique. An easy way of generating unique labels is to prefix them with the name of the scope (i.e., the procedure name) they are defined in.

The assembly file generated by snuplc can be compiled using gcc as follows
```bash
  $ gcc -c primes.mod.s
```

The `-c` instructs the assembler just to assemble the input file into an object file.

To generate an executable file, the object file is linked together with the provided SnuPL/2 runtime library (array and I/O routines):
```bash
  $ gcc -L../../snuplc/rtl/x86-64 -o primes primes.mod.o -lsnupl
```

Of course, this can be done in a single step:
```bash
  $ gcc -L../../snuplc/rtl/x86-64 -o primes primes.mod.s -lsnupl
```

The SnuPL/2 compiler can execute these commands for you if provided with the --exe option
```bash
  $ snuplc --exe primes.mod
```

The SnuPL/2 compiler supports a number of configuration options; have a look at
```bash
  $ snuplc --help
```
